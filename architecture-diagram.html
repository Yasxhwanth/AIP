<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C3 AIP Architecture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #080c16;
            /* Deep dark blue background */
            color: white;
        }

        .box-glow {
            box-shadow: 0 0 15px currentColor;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
        }

        .inner-box {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid currentColor;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.1);
        }

        /* Arrows styling */
        .arrow-right {
            display: inline-block;
            width: 20px;
            height: 2px;
            background-color: currentColor;
            position: relative;
            margin: 0 10px;
        }

        .arrow-right::after {
            content: '';
            position: absolute;
            right: 0;
            top: -4px;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-left: 5px solid currentColor;
        }

        .arrow-down {
            display: inline-block;
            width: 2px;
            height: 20px;
            background-color: currentColor;
            position: relative;
            margin: 10px auto;
        }

        .arrow-down::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: -4px;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid currentColor;
        }
    </style>
</head>

<body class="p-8 min-h-screen flex flex-col items-center relative">

    <h1 class="text-4xl font-bold mb-8 text-white tracking-wider glow-text tracking-widest uppercase relative z-10">C3
        AIP - Phase 5 Architecture</h1>

    <!-- SVG OVERLAY FOR DYNAMIC CONNECTIONS -->
    <svg id="connection-svg" class="absolute inset-0 pointer-events-none z-0 w-full h-full" style="min-height: 1200px;">
        <defs>
            <marker id="arrowhead-indigo" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                <polygon points="0 0, 6 3, 0 6" fill="#818cf8" />
            </marker>
        </defs>

        <!-- Integration Scheduler to Job Executor -->
        <path id="path-integration" d="" fill="none" stroke="#818cf8" stroke-width="2" stroke-dasharray="6,4"
            marker-end="url(#arrowhead-indigo)" opacity="0.8" />

        <!-- Rollup Scheduler to Rollup Engine -->
        <path id="path-rollup" d="" fill="none" stroke="#818cf8" stroke-width="2" stroke-dasharray="6,4"
            marker-end="url(#arrowhead-indigo)" opacity="0.8" />
    </svg>

    <!-- SVG OVERLAY FOR DYNAMIC CONNECTIONS -->
    <svg class="absolute inset-0 pointer-events-none z-0 w-full h-full" style="min-height: 1200px;">
        <defs>
            <marker id="arrowhead-indigo" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                <polygon points="0 0, 6 3, 0 6" fill="#818cf8" />
            </marker>
        </defs>

        <!-- Integration Scheduler to Job Executor (Approximate positions) -->
        <!-- Starting around right edge of schedulers box, sweeping down to Job Executor -->
        <path d="M 1250 350 Q 1300 350, 1300 240 Q 1300 200, 950 200" fill="none" stroke="#818cf8" stroke-width="2"
            stroke-dasharray="6,4" marker-end="url(#arrowhead-indigo)" opacity="0.8" />

        <!-- Rollup Scheduler to Rollup Engine -->
        <path d="M 1250 420 Q 1350 420, 1350 560 Q 1350 700, 1020 700 T 985 680" fill="none" stroke="#818cf8"
            stroke-width="2" stroke-dasharray="6,4" marker-end="url(#arrowhead-indigo)" opacity="0.8" />
    </svg>

    <div class="relative w-full max-w-6xl flex items-start gap-8 z-10">

        <!-- Main Architecture Stack -->
        <div class="flex-1 flex flex-col gap-6" id="main-stack">

            <!-- ROW 0: API GATEWAY & SECURITY (New) -->
            <div class="flex flex-row items-center">
                <div class="w-32 text-xs font-semibold uppercase tracking-widest text-pink-500 mr-4 text-right">ROW
                    0<br>Security Layer</div>
                <div class="flex-1 border-2 border-pink-500 rounded-xl p-4 text-pink-500 box-glow">
                    <div class="text-center font-bold mb-3 uppercase tracking-wider text-sm">API Gateway & Enterprise
                        Security (Phase 5)</div>
                    <div class="flex justify-center flex-wrap gap-4">
                        <div class="rounded-lg px-4 py-2 text-sm text-center inner-box w-48 text-pink-300">API Gateway
                            Router</div>
                        <div class="rounded-lg px-4 py-2 text-sm text-center inner-box w-48 text-pink-300">Auth & API
                            Key Middleware</div>
                        <div class="rounded-lg px-4 py-2 text-sm text-center inner-box w-48 text-pink-300">Rate Limiting
                            Engine</div>
                        <div class="rounded-lg px-4 py-2 text-sm text-center inner-box w-48 text-pink-300">Audit Logging
                        </div>
                    </div>
                </div>
            </div>

            <!-- Down Arrow -->
            <div class="flex justify-center text-pink-500">
                <div class="arrow-down"></div>
            </div>

            <!-- ROW 1: EXTERNAL SOURCES -->
            <div class="flex flex-row items-center">
                <div class="w-32 text-xs font-semibold uppercase tracking-widest text-orange-500 mr-4 text-right">ROW
                    1<br>External Sources</div>
                <div class="flex-1 border-2 border-orange-500 rounded-xl p-4 text-orange-500 box-glow">
                    <div class="flex justify-center gap-6">
                        <div class="rounded-lg px-6 py-3 text-sm font-semibold text-center inner-box text-orange-200">
                            REST APIs</div>
                        <div class="rounded-lg px-6 py-3 text-sm font-semibold text-center inner-box text-orange-200">
                            JSON / CSV Upload</div>
                        <div class="rounded-lg px-6 py-3 text-sm font-semibold text-center inner-box text-orange-200">
                            Direct API Calls</div>
                    </div>
                </div>
            </div>

            <!-- Down Arrow -->
            <div class="flex justify-center text-orange-500">
                <div class="arrow-down"></div>
            </div>

            <!-- ROW 2: DATA INGESTION LAYER -->
            <div class="flex flex-row items-center">
                <div class="w-32 text-xs font-semibold uppercase tracking-widest text-teal-400 mr-4 text-right">ROW
                    2<br>Data Ingestion Layer</div>
                <div class="flex-1 border-2 border-teal-400 rounded-xl p-4 text-teal-400 box-glow">
                    <div class="flex justify-center items-center gap-2">
                        <div
                            class="rounded-lg px-4 py-3 text-sm font-semibold text-center inner-box text-teal-100 w-48">
                            Connector<br>Framework</div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-4 py-3 text-sm font-semibold text-center inner-box text-teal-100 w-48">
                            Transform<br>Engine</div>
                        <div class="arrow-right"></div>
                        <div id="target-job-executor"
                            class="rounded-lg px-4 py-3 text-sm font-semibold text-center inner-box text-teal-100 w-48 relative z-20">
                            Job Executor &<br>Scheduler</div>
                    </div>
                </div>
            </div>

            <!-- Down Arrow -->
            <div class="flex justify-center text-teal-400">
                <div class="arrow-down"></div>
            </div>

            <!-- ROW 3: CORE ONTOLOGY LAYER -->
            <div class="flex flex-row items-center">
                <div class="w-32 text-xs font-semibold uppercase tracking-widest text-blue-500 mr-4 text-right">ROW
                    3<br>Core Ontology Layer</div>
                <div class="flex-1 border-2 border-blue-500 rounded-xl p-4 text-blue-500 box-glow">
                    <div class="text-center font-bold mb-3 uppercase tracking-wider text-sm">Core Ontology Layer</div>
                    <div class="flex justify-center items-center gap-4">
                        <div
                            class="rounded-lg px-4 py-3 text-sm font-semibold text-center inner-box text-blue-200 flex-1">
                            Entity Types +<br>Attributes</div>
                        <div
                            class="rounded-lg px-4 py-3 text-sm font-semibold text-center inner-box text-blue-200 flex-1">
                            Entity Instances<br>(Bi-Temporal)</div>
                        <div
                            class="rounded-lg px-4 py-3 text-sm font-semibold text-center inner-box text-blue-200 flex-1">
                            Relationship<br>Definitions</div>
                        <div
                            class="rounded-lg px-4 py-3 text-sm font-semibold text-center inner-box text-blue-200 flex-1">
                            Relationship Graph<br>(Temporal)</div>
                    </div>
                    <div class="text-center text-xs mt-3 text-blue-300">validFrom / validTo / transactionTime</div>
                </div>
            </div>

            <div class="flex gap-4">
                <!-- ROW 4 LEFT: EVENT & POLICY LAYER -->
                <div class="flex-1 flex flex-col items-center">
                    <div class="text-purple-400">
                        <div class="arrow-down"></div>
                    </div>
                    <div class="w-full border-2 border-purple-500 rounded-xl p-4 text-purple-500 box-glow h-full">
                        <div class="text-center font-bold mb-3 uppercase tracking-wider text-sm">Event & Policy Layer
                        </div>
                        <div class="flex justify-center items-center gap-2">
                            <div
                                class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-purple-200 flex-1">
                                Domain Events<br>(Append-Only)</div>
                            <div class="arrow-right"></div>
                            <div
                                class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-purple-200 flex-1">
                                Policy<br>Engine</div>
                            <div class="arrow-right"></div>
                            <div
                                class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-purple-200 flex-1">
                                Alerts</div>
                        </div>
                    </div>
                </div>

                <!-- ROW 4 RIGHT: TIME-SERIES LAYER -->
                <div class="flex-[1.5] flex flex-col items-center">
                    <div class="text-green-500">
                        <div class="arrow-down"></div>
                    </div>
                    <div class="w-full border-2 border-green-500 rounded-xl p-4 text-green-500 box-glow h-full">
                        <div class="text-center font-bold mb-3 uppercase tracking-wider text-sm">Time-Series Layer</div>
                        <div class="flex justify-center items-center gap-2 flex-wrap">
                            <div
                                class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-green-200 w-24">
                                Telemetry<br>Ingestion</div>
                            <div class="arrow-right"></div>
                            <div
                                class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-green-200 w-24">
                                Raw<br>Metrics</div>
                            <div class="arrow-right"></div>
                            <div id="target-rollup-engine"
                                class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-green-200 w-24 relative z-20">
                                Rollup Engine<br>(5m/1h/1d)</div>
                            <div class="arrow-right"></div>
                            <div
                                class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-green-200 w-24">
                                Aggregated<br>Buckets</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Down Arrow Multi-Path (Visual Representation) -->
            <div class="flex justify-center gap-64">
                <div class="arrow-down text-purple-500"></div>
                <div class="arrow-down text-green-500"></div>
            </div>

            <!-- ROW 5: INTELLIGENCE LAYER -->
            <div class="flex flex-row items-center">
                <div class="w-32 text-xs font-semibold uppercase tracking-widest text-yellow-500 mr-4 text-right">ROW
                    5<br>Intelligence Layer</div>
                <div class="flex-1 border-2 border-yellow-500 rounded-xl p-4 text-yellow-500 box-glow">
                    <div class="text-center font-bold mb-3 uppercase tracking-wider text-sm">Intelligence Layer</div>
                    <div class="flex justify-center gap-6">
                        <div
                            class="rounded-lg px-6 py-4 text-sm font-semibold text-center inner-box text-yellow-100 flex-1">
                            Computed Metrics<br><span class="text-xs font-normal">(Expression Parser)</span></div>
                        <div
                            class="rounded-lg px-6 py-4 text-sm font-semibold text-center inner-box text-yellow-100 flex-1">
                            CQRS Read Models</div>
                    </div>
                </div>
            </div>

            <!-- Down Arrow -->
            <div class="flex justify-center text-yellow-500">
                <div class="arrow-down"></div>
            </div>

            <!-- ROW 6: ML MODEL REGISTRY -->
            <div class="flex flex-row items-center">
                <div class="w-32 text-xs font-semibold uppercase tracking-widest text-red-500 mr-4 text-right">ROW
                    6<br>ML Model Registry</div>
                <div class="flex-1 border-2 border-red-500 rounded-xl p-4 text-red-500 box-glow">
                    <div class="text-center font-bold mb-3 uppercase tracking-wider text-sm">ML Model Registry</div>
                    <div class="flex justify-center items-center gap-2">
                        <div
                            class="rounded-lg px-3 py-3 text-xs font-semibold text-center inner-box text-red-200 flex-1">
                            Model Registry</div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-3 py-3 text-xs font-semibold text-center inner-box text-red-200 flex-1">
                            Version Lifecycle</div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-3 py-3 text-xs font-semibold text-center inner-box text-red-200 flex-1">
                            Inference Engine<br>(4 Strategies)</div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-3 py-3 text-xs font-semibold text-center inner-box text-red-200 flex-1">
                            Inference Results</div>
                    </div>
                </div>
            </div>

            <!-- Down Arrow -->
            <div class="flex justify-center text-red-500">
                <div class="arrow-down"></div>
            </div>

            <!-- ROW 7: DECISION & EXECUTION ENGINE -->
            <div class="flex flex-row items-center">
                <div class="w-32 text-xs font-semibold uppercase tracking-widest text-cyan-400 mr-4 text-right">ROW
                    7<br>Decision Engine</div>
                <div class="flex-1 border-2 border-cyan-400 rounded-xl p-4 text-cyan-400 box-glow relative">
                    <div class="text-center font-bold mb-3 uppercase tracking-wider text-sm">Decision & Execution Engine
                    </div>
                    <div class="flex justify-center items-center gap-1 flex-wrap">
                        <div
                            class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-cyan-100 w-28 text-center">
                            Decision Rules<br>(AND/OR)</div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-cyan-100 w-24 text-center">
                            Condition<br>Evaluator</div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-cyan-100 w-24 text-center">
                            Execution<br>Plans</div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-cyan-100 w-32 text-center">
                            5 Action Types<br><span class="text-[9px] font-normal">[Webhook, Update Entity, Alert,
                                Inference, Log]</span></div>
                        <div class="arrow-right"></div>
                        <div
                            class="rounded-lg px-2 py-3 text-xs font-semibold text-center inner-box text-cyan-100 w-20 text-center">
                            Audit<br>Trail</div>
                    </div>
                    <div class="text-center text-xs mt-3 text-cyan-200">Simulation Mode | Human-In-the-Loop</div>
                </div>
            </div>

            <!-- Down Arrow -->
            <div class="flex justify-center text-cyan-400">
                <div class="arrow-down"></div>
            </div>

            <!-- DATABASE -->
            <div class="flex justify-center mt-8">
                <div class="w-2/3 border-2 border-slate-500 rounded-[50%] p-6 text-slate-300 box-glow bg-slate-900 shadow-xl"
                    style="border-radius: 50% / 30px;">
                    <div class="text-center font-bold uppercase tracking-wider text-xl mb-2">POSTGRESQL DATABASE</div>
                    <div class="text-center text-sm">23 Tables | Phase 5 Enterprise Security Enabled</div>
                </div>
            </div>

            <!-- Down Arrow into Data Models -->
            <div class="flex justify-center text-slate-500 mt-4">
                <div class="arrow-down h-12"></div>
            </div>

            <!-- DATA MODELS (Domain Entities) -->
            <div
                class="flex flex-col gap-4 w-full border border-slate-700/50 bg-slate-900/50 rounded-xl p-8 mt-2 mb-12">
                <div
                    class="text-center font-bold text-slate-300 uppercase tracking-widest mb-6 border-b border-slate-700/50 pb-4">
                    Layers
                    Explained</div>

                <div class="space-y-4 text-sm text-slate-300 leading-relaxed">
                    <p><span class="font-bold text-pink-400">0. API Gateway & Security:</span> (Added in Phase 5)
                        Secures the entire platform with API Key validation, Role-Based Access Control (RBAC), and 100
                        req/min rate limiting.</p>
                    <p><span class="font-bold text-orange-400">1. External Sources:</span> The various ways data enters
                        the system.</p>
                    <p><span class="font-bold text-teal-400">2. Data Integration Layer:</span> Handles polling from
                        external <code>DataSource</code>s and mapping data into the ontology via
                        <code>IntegrationJob</code>s and <code>JobExecution</code>s.</p>
                    <p><span class="font-bold text-blue-400">3. Core Ontology Layer:</span> The heart of the system.
                        Defines the shape of the world (<code>EntityType</code>, <code>AttributeDefinition</code>) and
                        holds the bi-temporal state (<code>EntityInstance</code>). It treats relationships as
                        first-class citizens.</p>
                    <p><span class="font-bold text-purple-400">4. Event & Policy Layer:</span> Append-only log of
                        changes (<code>DomainEvent</code>). The Policy Engine evaluates events in real-time to generate
                        <code>Alert</code>s.</p>
                    <p><span class="font-bold text-green-400">5. Time-Series Layer:</span> (Added in Phase 4)
                        High-velocity metrics ingestion (<code>TimeseriesMetric</code>) optimized for append-heavy
                        workloads, aggregated periodically by the Rollup Engine.</p>
                    <p><span class="font-bold text-yellow-400">6. Intelligence Layer:</span> Combines ontology data and
                        metrics to execute <code>ComputedMetricDefinition</code> formulas algebraically on the fly.
                        Maintains CQRS read models for fast querying.</p>
                    <p><span class="font-bold text-red-400">7. ML Model Registry:</span> Manages predictive models
                        (<code>ModelDefinition</code>, <code>ModelVersion</code>) and executes inferences using
                        predefined strategies (Threshold, Z-Score, Linear Regression).</p>
                    <p><span class="font-bold text-cyan-400">8. Decision & Execution Engine:</span> Replaces human
                        operators dynamically. Evaluates rules (<code>DecisionRule</code>) and executes a workflow of
                        steps (<code>ExecutionPlan</code>) encompassing API calls, entity updates, and alert generation.
                    </p>
                    <p><span class="font-bold text-slate-400">9. Database (PostgreSQL):</span> The bottom persistence
                        layer backing all of the above, currently sitting at 23 tables.</p>
                </div>
            </div>

        </div>

        <div class="w-64 pt-64 flex flex-col gap-4 sticky top-8 z-20">
            <div class="border-2 border-indigo-400 rounded-xl p-4 text-indigo-400 box-glow">
                <div class="text-center font-bold mb-4 uppercase tracking-wider text-sm">Background Schedulers</div>
                <div class="flex flex-col gap-4">
                    <div id="source-integration"
                        class="rounded-lg px-4 py-3 text-sm font-semibold text-center shadow-[inset_0_0_10px_rgba(255,255,255,0.1)] bg-indigo-900/30 border border-indigo-500 text-indigo-200 relative">
                        Integration Scheduler<br>(60s)
                    </div>
                    <div id="source-rollup"
                        class="rounded-lg px-4 py-3 text-sm font-semibold text-center shadow-[inset_0_0_10px_rgba(255,255,255,0.1)] bg-indigo-900/30 border border-indigo-500 text-indigo-200 relative">
                        Rollup Scheduler<br>(5m)
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateConnections() {
            const getCoords = (el) => {
                const rect = el.getBoundingClientRect();
                return {
                    x: rect.left + window.scrollX,
                    y: rect.top + window.scrollY,
                    width: rect.width,
                    height: rect.height,
                    right: rect.right + window.scrollX,
                    bottom: rect.bottom + window.scrollY,
                    centerX: rect.left + window.scrollX + rect.width / 2,
                    centerY: rect.top + window.scrollY + rect.height / 2
                };
            };

            const srcInt = document.getElementById('source-integration');
            const srcRoll = document.getElementById('source-rollup');
            const tgtJob = document.getElementById('target-job-executor');
            const tgtRoll = document.getElementById('target-rollup-engine');

            const pathInt = document.getElementById('path-integration');
            const pathRoll = document.getElementById('path-rollup');

            if (!srcInt || !srcRoll || !tgtJob || !tgtRoll || !pathInt || !pathRoll) return;

            const cSrcInt = getCoords(srcInt);
            const cSrcRoll = getCoords(srcRoll);
            const cTgtJob = getCoords(tgtJob);
            const cTgtRoll = getCoords(tgtRoll);

            // Integration Scheduler (left side) to Job Executor (right side)
            const intStartX = cSrcInt.x;
            const intStartY = cSrcInt.centerY;
            const intEndX = cTgtJob.right + 10;
            const intEndY = cTgtJob.centerY;

            const intCx1 = intStartX - 100;
            const intCy1 = intStartY;
            const intCx2 = intEndX + 100;
            const intCy2 = intEndY;

            // Rollup Scheduler (left side) to Rollup Engine (top center or right)
            const rollStartX = cSrcRoll.x;
            const rollStartY = cSrcRoll.centerY;
            const rollEndX = cTgtRoll.right + 10;
            const rollEndY = cTgtRoll.centerY;

            const rollCx1 = rollStartX - 150;
            const rollCy1 = rollStartY;
            const rollCx2 = rollEndX + 50;
            const rollCy2 = rollEndY;

            pathInt.setAttribute('d', `M ${intStartX} ${intStartY} C ${intCx1} ${intCy1}, ${intCx2} ${intCy2}, ${intEndX} ${intEndY}`);
            pathRoll.setAttribute('d', `M ${rollStartX} ${rollStartY} C ${rollCx1} ${rollCy1}, ${rollCx2} ${rollCy2}, ${rollEndX} ${rollEndY}`);
        }

        window.addEventListener('load', updateConnections);
        window.addEventListener('resize', updateConnections);
        setTimeout(updateConnections, 100);
        setTimeout(updateConnections, 500);
    </script>
</body>

</html>